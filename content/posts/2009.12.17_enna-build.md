---
title: "Autour de la compilation d'Enna ~ üá´üá∑"
date: 2009-12-17
tags: [geexbox, enna, libplayer, libvalhalla]
description: "Anne is building Enna"
draft: false
---

Hello,

je tiens juste √† donner quelques pr√©cisions pour les personnes qui d√©sirent
compiler Enna, et donc √©galement les biblioth√®ques rattach√©es. Cet article n'est
pas un tutoriel. Si vous ne savez pas comment vous y prendre, il vaut mieux
rechercher l'information ailleurs.

Faites aussi un tour √† ces adresses (en anglais / in english) :  
http://enna.geexbox.org/developers.html  
http://captainigloo.wordpress.com/2009/12/21/enna-compilation-on-ubuntu-3/

## Evas

![](/img/efl.png)

Comme vous le savez, Enna se base sur les EFL. Je vous conseil fortement
d'utiliser les [snapshots][1] ne serait-ce au moins pour ne pas que vous
reportiez des "bugs" juste parce que les APIs des EFL auraient trop √©volu√©es. En
partant du principe que vous savez compiler les EFL, je vous rappel de ne pas
oublier le flag `‚Äì‚Äìenable‚Äìgl‚Äìx11` avec Evas, si vous avez l'acc√©l√©ration 3D avec
votre PC. Les performances graphiques d'Enna sont nettement meilleurs. Toujours
concernant Evas, il y a une petite modification dans les sources qui vous
permettra d'avoir des textures anti-alias√©es. Dans le cas contraire, Enna est
plus beau (mais plus lent) en X11 Software plut√¥t qu'en OpenGL. Il faut tout
simplement modifier les d√©finitions `GL_NEAREST` en `GL_LINEAR` dans toutes les
sources.

```sh
cd ~/e17_src/evas
sed -i "s/GL_NEAREST/GL_LINEAR/g" \
    `grep -Rl GL_NEAREST . | grep "\.c$"`
```

[1]: http://download.enlightenment.org/snapshots/LATEST/

## Libgeexbox

Libgeexbox est une mani√®re na√Øve de parler de toutes les biblioth√®ques que nous
d√©veloppons en parall√®le √† la distribution et √† Enna. Depuis quelques temps, des
releases sont apparues pour libnfo, libplayer et libvalhalla. Il faut savoir que
se sont les toutes premi√®res releases! L√† o√π je veux en venir c'est qu'il √©tait
totalement justifi√© de toujours se baser sur les versions de d√©veloppement pour
compiler Enna. Par exemple le premier import de libplayer date de 2006 et
c'√©tait une habitude que de faire un `hg pull -u` r√©guli√®rement. Mais maintenant
que les versions 1.0.0 sont disponibles, veuillez s.v.p. vous baser uniquement
sur celles-ci (ou sur n'importe quelles nouvelles releases de ces libs dans le
futur).

Il y a deux solutions, en passant sur les sites web respectifs des projets (les
liens sont disponibles √† droite des articles de ce blog) ou alors avec
Mercurial. Mais dans ce cas veuillez pr√©ciser la version de la derni√®re release.
Tel que par exemple :

```sh
hg clone -r v1.0.0 http://hg.geexbox.org/libvalhalla
```

Si vous chargez la devel (donc le "tip") vous ne pourrez pas compiler Enna ou
alors vous avez de la chance :-). Depuis qu'il y a les releases je me permets de
casser les APIs des biblioth√®ques parce que je suis un √©ternel insatisfait (je
rigole‚Ä¶) et √ßa faisait longtemps que je voulais faire un peu de m√©nage dans
certaines en-t√™tes publiques.

Et apr√®s l'installation des libgeexbox, n'oubliez pas de faire un
`sudo ldconfig`. Question que le chargeur de programme ait les nouvelles
biblioth√®ques de r√©f√©renc√©es.

### libvalhalla

<img src="/img/libvalhalla.png" width="40%"/>

Quand vous ex√©cutez le configure de libvalhalla, jetez un ≈ìil aux informations
retourn√©es avant de faire b√™tement un `make`. Le configure d√©sactive les
√©l√©ments en fonction des biblioth√®ques qu'il ne trouve pas. Par exemple, si vous
n'avez pas la libcurl-dev, le support des grabbers est compl√®tement d√©sactiv√©
mais cela n'emp√™che pas la compilation.

Admettons que vous avez toutes les libs n√©cessaires et que vous voyez certains
grabbers de d√©sactiv√©s. Je pense par exemple √† lyricsfly. Ce n'est pas un bug.
Lyricsfly n'est pas utilisable car la clef de l'API pour le webservice √©tait
provisoire. Ce grabber est donc d√©sactiv√© par d√©faut. Si vous utilisez
`‚Äì‚Äìenable‚Äìgrabbers` pour √™tre s√ªr d'activer tous les grabbers vous n'aurez rien
√† gagner. Vous ferez perdre du temps √† libvalhalla sur lyricsfly qui ne
retournera jamais rien (je parle de lyricsfly, mais √ßa peut √™tre d'autres √†
l'avenir).

A noter √©galement que d√®s que vous forcez les grabbers ou seulement quelques
grabbers, leurs d√©pendances deviennent obligatoires. Par exemple si vous faites
`‚Äì‚Äìenable‚Äìgrabber‚Äìffmpeg` vous forcez la d√©pendance sur libavcodec. Si vous avez
vraiment libavcodec et que √ßa √©choue, c'est simplement que votre version est
trop ancienne. Par exemple, le libavcodec que vous trouvez avec Ubuntu Karmic ne
supporte pas la fonction av_lockmgr_register() qui garanti l'utilisation des
codecs √† √™tre multi-thread safe.

### libplayer

<img src="/img/libplayer.png" width="40%"/>

Concernant libplayer, c'est la d√©pendance indirecte avec MPlayer qui est la plus
importante. Assurez-vous que votre MPlayer est en anglais uniquement. Libplayer
peut d√©tecter les MPlayer incompatibles jusqu'√† un certain point. En fonction de
la mani√®re dont MPlayer a √©t√© compil√©, libplayer ne peut pas savoir s'il est en
anglais ou non et va donc l'utiliser (pour les curieux, je parle de la variable
d'environnement LINGUAS √† la compilation d'MPlayer; libplayer ne d√©tecte la
langue que si celle-ci est pass√©e avec `‚Äì‚Äìlanguage‚Äìmsg=` ou `‚Äì‚Äìlanguage=`).

## D√©marrer Enna

Contrairement √† certains tutoriels sur Enna, il n'est pas n√©cessaire de copier
le fichier d'exemple `enna.cfg` qui se trouve √† la racine des sources, dans le
dossier `~/.enna`. Parce que ce fichier est automatiquement cr√©√© au premier
d√©marrage de l'interface. Et allez jeter un ≈ìil au contenu. Si vous voulez que
libvalhalla puisse faire son travail, vaut mieux lui dire o√π il doit scanner.
Dans le cas contraire 100% des fichiers seront trait√©s en ondemand (je vous
laisser chercher dans ce blog si vous ne comprenez pas).

Et maintenant que vous avez l'OpenGL, vous remarquerez assez vite qu'en le
sp√©cifiant dans `~/.enna/enna.cfg` √ßa ne change pas grand chose. Pire que cela,
√ßa ne change absolument rien ;-).

Pour l'instant il faudra le faire √† la main depuis un terminal, avec :

```sh
ELM_ENGINE=gl enna
```

A bient√¥t,  
Mathieu SCHROETER
