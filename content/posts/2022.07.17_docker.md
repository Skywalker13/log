---
title: "Docker ~ ğŸ‡«ğŸ‡·"
date: 2022-07-17
tags: [docker, vm]
description: "Docker"
draft: false
---

Depuis que Microsoft joue avec Linux dans Windows 10 et ses suites, on nous sert
du Docker Ã  toutes les sauces pour Ã  peu prÃ¨s tout et nâ€™importe quoi. Voici ce
que jâ€™en pense et pourquoi Docker existe (de mon point de vue) au dÃ©part. Avant
lâ€™invention des `cgroups` Linux, on multipliait les machines virtuelles. Il
Ã©tait assez dÃ©licat pour un hÃ©bergeur de fournir du mutualisÃ© â€œouvertâ€ (oÃ¹ il
est possible dâ€™Ãªtre `root` mais en Ã©tant sur un unique systÃ¨me). Avec les
`cgroups`, Docker est apparu. On peut alors crÃ©er des sandboxes bien isolÃ©es
tout en conservant un seul systÃ¨me dâ€™exploitation Linux (le recours aux machines
virtuelles devient de moins en moins nÃ©cessaire).

## Docker et les machines virtuelles

Aujourdâ€™hui, je constate quelques absurditÃ©s. Par exemple, le fait dâ€™utiliser
Docker dans une machine virtuelle, quand justement **lâ€™objectif est de sâ€™en
passer**.

Il vaut mieux supprimer complÃ¨tement les machines virtuelles et crÃ©er des
conteneurs Docker sur le systÃ¨me dâ€™exploitation de base. En effet, avec les
machines virtuelles, vous avez un hyperviseur dans lequel vous les installez.
Avec Docker, le superviseur devient lâ€™hÃ´te qui hÃ©berge Docker et les machines
virtuelles deviennent les conteneurs.

Ceci mâ€™amÃ¨ne Ã  lâ€™aberration totale de ce que je constate en pratique. On y voit
autant de conteneurs que de services quand tous ces services appartiennent au
mÃªme client. Par exemple, on y trouve nginx dans un conteneur, un service mÃ©tier
quelconque dans un second conteneur, un moteur de base de donnÃ©es dans un
troisiÃ¨me conteneur.

Quâ€™est-ce que cela donne avec lâ€™analogie sous forme de machines virtuelles ? Eh
bien, vous installez un hyperviseur dans lequel vous crÃ©ez trois machines
virtuelles, et dans chacune de ces machines virtuelles, vous installez un
systÃ¨me dâ€™exploitation afin dâ€™y faire tourner un seul service par installation.
Câ€™est absurde, non ?

> Mais Ã§a nâ€™a rien Ã  voir, avec Docker je nâ€™installe pas plusieurs systÃ¨mes
> dâ€™exploitations et en plus jâ€™ai de lâ€™isolation entre les processes.

Mais sÃ©rieusement, vous mâ€™avez lu et compris ? Je ne crois pas. Ici, on parle
dâ€™un seul et mÃªme client. Les services communiquent forcÃ©ment entre eux car ils
sont destinÃ©s Ã  travailler ensemble. Quand vous installez tous vos services dans
un systÃ¨me, vous crÃ©ez un compte pour chaque service et donnez les droits
appropriÃ©s. Il y a forcÃ©ment de lâ€™isolation entre vos processes selon comment
vous attribuez ceux-ci (je parle des **droits**). Tout systÃ¨me dâ€™exploitation
qui se respecte le fait dÃ©jÃ  depuis bien avant lâ€™apparition de Docker. Pourquoi
remettre en cause les services managers des systÃ¨mes dâ€™exploitation sachant que
de toute faÃ§on votre hyperviseur en utilise un et que vous lui faites confiance.

## Le mutualisÃ©

Selon moi, câ€™est simplement parce que vous nâ€™avez pas compris ce que vous
faites. Vous suivez la mode Docker oÃ¹ on y installe nâ€™importe quoi et surtout
nâ€™importe comment (il suffit de regarder les fichiers Dockerfile). Lâ€™isolation
quâ€™offre Docker a du sens au mÃªme titre que lâ€™isolation que font les
hyperviseurs de machines virtuelles. Prenez le cas des hÃ©bergeurs mutualisÃ©s.
Vous ne pouvez pas dilapider vos ressources avec une machine virtuelle par
entreprise (client), alors, vous fournissez des solutions mutualisÃ©es. Le
mutualiser Windows est une catastrophe car (par exemple) il vous est impossible
dâ€™isoler lâ€™interface loopback que ce soit par utilisateur ou groupe
dâ€™utilisateur. Il suffit quâ€™un service Ã©coute en loopback pour que nâ€™importe
quels utilisateurs du serveur mutualisÃ© puisse y accÃ©der (et Microsoft arrive Ã 
donner lâ€™appellation Server Ã  ce genre dâ€™installation).

Maintenant passons Ã  Docker pour cet hÃ©bergeur. Dans ce cas, vous crÃ©ez un
conteneur par client. Chaque conteneur bÃ©nÃ©ficie dâ€™une vraie isolation (donc
mÃªme lâ€™interface loopback), vous ne risquez pas de mÃ©langer les services des
diffÃ©rents clients comme ce serait le cas avec un modÃ¨le plus simpliste comme
celui de Windows exprimÃ© ci-dessus. Le client qui loue ce conteneur, nâ€™a pas
besoin de savoir quâ€™il est dans un conteneur. Il peut sans autre installer ses
services avec le service manager de son choix et gÃ©rer son infrastructure
logicielle de maniÃ¨re tout Ã  fait classique. Pour lâ€™hÃ©bergeur, c'est extrÃªmement
intÃ©ressant, car les conteneurs sont beaucoup moins gourmands en ressource que
des machines virtuelles.

## Un gestionnaire de services

En conclusion, utilisez Docker comme vous utiliseriez des machines virtuelles.
Mais surtout, nâ€™utilisez pas Docker pour gÃ©rer vos services, **ce nâ€™est pas un
service manager**. Laissez les vrais gestionnaire de services faire ce job.
