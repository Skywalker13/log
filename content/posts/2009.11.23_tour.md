---
title: "Un (tout petit) tour d'horizon ~ üá´üá∑"
date: 2009-11-23
tags: [geexbox, libvalhalla, enna]
description: "Turn around ..."
draft: false
---

Yop,

un tout petit tour d'horizon s'impose. Le travail sur (et autour de) Enna fait
son petit bonhomme de chemin. Le design √©tait sans cesse modifi√© mais depuis
quelques semaines on a enfin quelque chose de relativement stable.
Personnellement je n'ai pas beaucoup travaill√© sur Enna car je continue √† me
concentrer sur libvalhalla. Il y a encore deux r√©gressions de Enna qui sont dues
√† l'utilisation de libvalhalla.

<img src="/img/libvalhalla.png" width="300px"/>

> Je parle de r√©gressions, bien qu'il n'y a jamais eu de sortie officielle et
> stable. Il faut comprendre par l√† qu'avec toutes les modifications qui ont √©t√©
> apport√©es √† Enna, de temps en temps des fonctionnalit√©s disparaissent
> simplement parce qu'elle devraient √™tre g√©r√©es d'une autre mani√®re.

**La premi√®re r√©gression** que je veux souligner est celle de pouvoir reprendre
la lecture d'un film √† l'endroit o√π il a √©t√© interrompu. Dit comme √ßa, il n'y a
rien d'exceptionnel. Mais "√† l'√©poque", l'enregistrement se faisait √† l'aide de
[Eet][3] qui √©tait √©galement utilis√© pour stocker les m√©ta-donn√©es des fichiers
audio/vid√©os. Depuis l'arriv√©e de libvalhalla et donc d'une base de donn√©e
SQLite, Eet n'avait plus beaucoup de sens et cette partie a √©t√© simplement
supprim√©e d'Enna. Mais la lib ne permet pas l'√©criture depuis son API publique
pour plusieurs raisons. Tout d'abord Valhalla ce n'est pas une biblioth√®que pour
g√©rer une base de donn√©e, mais c'est avant tout un scanner de fichiers, des
"parsers" et des "grabbers". Les donn√©es sont r√©cup√©r√©es par elle
automatiquement. Il est donc possible de les lire depuis l'API publique. Lorsque
des donn√©es doivent √™tre modifi√©es, elles le sont depuis les fichiers (tags ID3
par exemple), ou alors depuis les site internets qui fournissent des
informations (les grabbers, ImDB, Amazon, etc, ‚Ä¶).

Mais pour r√©pondre √† certains besoins comme la sauvegarde de la position d'un
film, il est n√©cessaire de reconsid√©rer cette question sur libvalhalla. J'ai
donc commenc√© √† travailler sur cet aspect il y a peu de temps. Il y aura ainsi
une information qui permettra d'identifier des donn√©es venant de l'ext√©rieur
(parser, grabbers, ‚Ä¶) et des donn√©es venant de l'int√©rieur. Pour mieux
comprendre pourquoi il est n√©cessaire de faire des s√©parations, l'exemple d'un
champ "playcount" est bien adapt√©. Le "playcount" (donc le nombre de fois qu'un
fichier est lu), d√©pend uniquement de l'utilisateur d'Enna. Si le fichier en
question est modifi√© (les tags par exemple), ce champ doit rester intacte ce qui
n'est pas possible actuellement.

**La deuxi√®me r√©gression** concerne les "snapshots" (ou "fanarts"). Ils servent
√† avoir une image illustrant une video. Par exemple les images suivantes
pr√©sentent les r√©sultats pour quatre "trailers" o√π des donn√©es int√©ressantes ont
pu √™tre r√©cup√©r√©es par les "grabbers" (j'ai r√©cup√©r√© les "trailers" sur le site
d'Apple, merci au blogger en lien [ici][1] et [ici][2] pour l'astuce).

[<img src="/img/terminator-salvation.jpg" width="400px">](/img/terminator-salvation.jpg)
[<img src="/img/inglourious-basterds.jpg" width="400px">](/img/inglourious-basterds.jpg)
[<img src="/img/silent-hill.jpg" width="400px">](/img/silent-hill.jpg)
[<img src="/img/gran-torino.jpg" width="400px">](/img/gran-torino.jpg)

Dans tous ces exemples les images de fond ont pu √™tre t√©l√©charg√©es sur le site
[TheMovieDB.org][4]. Mais il peut arriver qu'aucune image ne soient disponibles
et donc une alternative est n√©cessaire. Actuellement il y a une image de fond
par d√©faut pour ces cas de figure, mais le but est de cr√©er un "snapshot"
directement avec le contenu de la vid√©o. Cette fonctionnalit√© √©tait disponible √†
l'√©poque o√π libvalhalla n'existait pas, et libplayer faisait office
d'interm√©diaire pour r√©cup√©rer l'image √† 20% de la vid√©o. L'id√©e d√©sormais est
donc d'utiliser le "grabber" FFmpeg (ajout√© il y a peu de temps) pour extraire
l'image. Bien s√ªr, il ne faut pas l'extraire dans les cas o√π TheMovieDB contient
d√©j√† un "snapshot" de bien meilleur qualit√©.

Il y bien entendu toujours un panneau d'informations pour les vid√©os. Il va
encore probablement subir des modifications, et donc rien de ce qui est montr√©
dans ces "screenshots" ne peut √™tre consid√©r√© comme d√©finitif.

[<img src="/img/silent-hill-panel.jpg" width="400px">](/img/silent-hill-panel.jpg)

‚Ä¶

Il y a encore d'autres choses qui ont √©volu√©es aussi bien au niveau de l'audio
que de la vid√©o, mais mon objectif pour ce billet est uniquement de parler des
deux r√©gressions. Du c√¥t√© de libvalhalla, les "grabbers" tels que Amazon,
Allocine et LyricWiki re-fonctionnent normalement (esp√©rons que se sois pour
encore longtemps). A part √ßa, une grande partie des modifications sont internes
tel que de l'optimisation et des corrections de bugs par exemple.

A bient√¥t,  
Mathieu SCHROETER

[1]: http://www.hd-trailers.net/blog/how-to-download-hd-trailers-from-apple/
[2]:
  http://www.hd-trailers.net/blog/2009/08/20/direct-download-links-from-apple-are-not-working/
[3]: http://wiki.enlightenment.org/index.php/Eet
[4]: http://www.themoviedb.org/
