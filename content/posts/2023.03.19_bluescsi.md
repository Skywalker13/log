---
title: "Smaky & BlueSCSI ~ ðŸ‡«ðŸ‡·"
date: 2023-03-19
tags: [smaky, bluescsi, fosfat]
description: "Smaky & BlueSCSI"
draft: false
---

Il y a quelques temps j'ai Ã©tÃ© mis en contact avec un ancien Guru du Smaky,
Jean-Marc Koller. Je ne le connais que trÃ¨s peu mais j'ai tout de suite Ã©tÃ©
intÃ©ressÃ© par son projet du moment. Il cherche Ã  remplacer les disques SCSI des
Smaky par des cartes SD. J'ai immÃ©diatement fait mes petites recherches sur le
sujet, Jean-Marc fait rÃ©fÃ©rence Ã  la carte [BlueSCSI][1].

Il explique qu'il y a des problÃ¨mes de communications avec cet adaptateur,
peut-Ãªtre des problÃ¨mes de timing ou d'intÃ©gritÃ©. Quoi qu'il en soit, il y a de
sÃ©rieux problÃ¨mes de stabilitÃ©, et Jean-Marc Ã©tant un Ã©lectronicien avancÃ©
effectue toutes les mesures nÃ©cessaires pour identifier les causes. Cela semble
plutÃ´t mal parti, mais le projet [BlueSCSI][1] retient mon attention pour deux
raisons.

1. Le projet est open-source / open-hardware et libre. Ceci est un critÃ¨re
   essentiel. Une communautÃ© assez importante semble graviter autour, avec un
   canal Discord pour atteindre trÃ¨s rapidement les dÃ©veloppeurs et designers de
   la carte [BlueSCSI][1].
2. Ils ont crÃ©Ã©s deux versions de la [BlueSCSI][1]. A ce moment lÃ  je n'ai
   absolument aucune idÃ©e de la version utilisÃ©e par Jean-Marc. Mais vu le prix
   de la carte [BlueSCSI][1] v2, je l'achÃ¨te dans la foulÃ©e.

> Les problÃ¨mes rencontrÃ©s par Jean-Marc concernent la version 1 de la BlueSCSI.
> Il y avait principalement des problÃ¨mes de soudure.

## L'achat (un peu) Ã  l'aveugle

Je regarde un peu les sites proposÃ©s pour l'achat, et je m'arrÃªte sur [One Geek
Army Shop][2] qui est (au moment de l'achat) le seul revendeur qui propose la
carte [BlueSCSI][1] v2 en variante "Desktop" pour le marchÃ© europÃ©en.

> Il existe plusieurs variantes, comme Desktop (50-pin SCSI), DB25 ou PowerBook.

Bien entendu, le Smaky avec son disque SCSI Fujitsu, correspond Ã  du 50-pin. La
carte soudÃ©e et Ã  jour ne me coÃ»te qu'un peu plus de 60â‚¬. Je trouve le risque
pas trÃ¨s grand alors je commande sans trop rÃ©flÃ©chir.

![BlueSCSI](/img/diskscsi.jpg)

### RÃ©ception de la carte

Environ 3 ou 4 jours plus tard, je reÃ§ois la carte bien emballÃ©e et prÃªte Ã 
l'emploi. Il ne me reste plus qu'Ã  ouvrir mon Smaky, dÃ©brancher le disque SCSI
actuel, trouver un adaptateur Molex â†’ mini Molex ainsi qu'une simple carte SD
compatible.

Depuis de nombreuses annÃ©es je conserve toutes sortes de cÃ¢bles et matÃ©riel dans
ma cave. Il se trouve que j'ai exactement tout ce qui est nÃ©cessaire. Un vieil
adaptateur Molex que j'avais certainement rÃ©cupÃ©rÃ© sur de vieux serveurs de la
Ciba SC dans les annÃ©es 2000 ainsi qu'un adaptateur SD â†’ micro SD avec une carte
micro SD de 4 GB.

![BlueSCSI](/img/bluescsi.jpg)

## Monter un disque SCSI

Cette carte [BlueSCSI][1] est juste fantastique. Pour monter un disque SCSI il
suffit de formater la carte SD en FAT32 ou exFat et d'y dÃ©poser des images
disque. Par exemple, pour monter un disque SCSI ID 1, rien de plus simple que de
nommer l'image `HD10_512.hda`.

Voici Ã  quoi ressemble ma carte SD actuelle :

```
-rw-r--r-- 1 schroeterm schroeterm   26 19 mar 14:24  bluescsi.ini
-rw-r--r-- 1 schroeterm schroeterm 520M 15 mar  2007 'HD10_512 MS System.hda'
-rw-r--r-- 1 schroeterm schroeterm 508M 26 sep  2019 'HD20_512 DR Model.hda'
-rw-r--r-- 1 schroeterm schroeterm 520M 19 mar 15:20 'HD30_512 DR Dev.hda'
-rw-r--r-- 1 schroeterm schroeterm 4.1K  1 jan 01:00  log.txt
```

L'image `HD10_512 MS System.hda` est un dump de mon disque SCSI original que
j'ai rÃ©alisÃ© en 2007. Pour effectuer ce dump j'ai installÃ© le disque du Smaky
dans un PC avec un contrÃ´leur Adaptec (qui dort dans un carton); et avec l'aide
de la commande `dd`, je me suis fait une image binaire comme backup. J'ai
beaucoup utilisÃ© cette image pour effectuer des tests avec [Fosfat][3] pendant
que je dÃ©veloppais cette bibliothÃ¨que d'accÃ¨s au FOS (je vous laisse consulter
le lien si cela vous intÃ©resse; sous Debian / Ubuntu, simplement faire
`apt install fosfat`).

> [Fosfat][3] est l'outil parfait pour lire vos disques et disquettes Smaky avec
> Linux (et aussi en partie avec Windows). Par contre, je n'ai pas dÃ©veloppÃ© le
> support de l'Ã©criture. Mon travail de reverse engineering s'est stoppÃ© dÃ¨s que
> j'ai pu extraire ce que je souhaitais.

### bluescsi.ini

Il est possible de donner une configuration Ã  la carte [BlueSCSI][1] avec l'aide
d'un fichier INI. Avec un Smaky, ce fichier n'est pas nÃ©cessaire mais dans mon
cas je l'ai quand mÃªme installÃ© avec cette directive :

```ini
[SCSI]
EnableSCSI2=1 ; On
```

HonnÃªtement je ne sais pas si cela apporte rÃ©ellement une amÃ©lioration; mais
j'aime l'idÃ©e que les transferts soient plus rapide en spÃ©cifiant explicitement
le mode SCSI-2 bien que je n'ai aucune certitude de ce qui se passe rÃ©ellement
avec ce contrÃ´leur.

## DÃ©marrage du Smaky

Tout Ã  fonctionnÃ© du **premier coup**. Mon Smaky a dÃ©marrÃ© comme un charme sur
le disque `HD10`. J'ai pu monter le disque `HD20` en `#MM2:` puis j'ai tentÃ©
aussi `HD30` en `#MM3:`. J'ai quelques problÃ¨mes avec le disques `HD30` mais
rien qui ne concerne la [BlueSCSI][1]. L'expÃ©rience est une rÃ©ussite complÃ¨te
qui va au delÃ  de mes espÃ©rances. Le fait de pouvoir monter plusieurs disques
avec un seul adaptateur est tout simplement gÃ©nial.

![BlueSCSI](/img/smaky.jpg)

## InteropÃ©rabilitÃ©

A l'origine, les Ã©changes entre les Smaky et les PC sont assez difficiles. Pour
y remÃ©dier en partie, j'ai crÃ©Ã© [Fosfat][3] il y a pas mal d'annÃ©es. DÃ¨s le
moment que l'on souhaite lire des donnÃ©es d'un Smaky sur un PC, [Fosfat][3]
rempli parfaitement son rÃ´le. Il existe une autre technique, l'utilisation de
l'Ã©mulateur Windows [Smaky Infini][4]. Cet Ã©mulateur me pose quelques problÃ¨mes
de stabilitÃ© et certains outils sont difficilement exploitables (comme les
outils de conversions de fichiers `.AUDIO` en `.WAV` qui fonctionnent bien que
sur un vrai Smaky ou alors l'impossibilitÃ© de lire certains dossiers du PC sans
que cela provoque un blocage complet de l'Ã©mulateur, ...).

L'Ã©mulateur ne se comporte pas non plus comme s'il avait Ã  faire Ã  de vrais
disques SCSI. En effet, j'ai remarquÃ© que le disque `SYSTEME` et le disque
`MODELE` ne sont pas des images disque SCSI, mais des images de type "floppy".
J'ai appris Ã  les diffÃ©rencier en travaillant sur [Fosfat][3] oÃ¹ il y a
clairement une diffÃ©rence d'offset entre les deux types de mÃ©dias.

Cette diffÃ©rence a un impacte directe avec l'utilisation de la [BlueSCSI][1].

1. Il n'est pas possible d'utiliser une image disque (de type `.DI`) en tant
   qu'image SCSI. Le Smaky refuse de la monter.
2. Le [Smaky Infini][4] refuse de monter une image disque SCSI comme si cette
   image Ã©tait un `.DI`.

J'ai tentÃ© d'y remÃ©dier avec `CLE`. Par exemple en montant une image Ã  la place
du disque `MODELE` dans le [Smaky Infini][4]. Je peux formater cette image
depuis `CLE` avec :

```
format #MM2:
```

Je peux alors Ã©crire dans cette image. Par contre, bien que le [Smaky Infini][4]
me l'affiche comme une mÃ©moire de masse, ce n'en est pas vraiment une. En
rÃ©alitÃ© c'est un type `$FILE_2` qui est un `DI` et donc impossible Ã  monter en
tant que disque SCSI sur la [BlueSCSI][1].

### Quelques solutions Ã  explorer

La meilleure solution serait que j'implÃ©mente l'Ã©criture avec [Fosfat][3]. C'est
un gros travail de recherche et j'ai d'autres projets sur le feu. Peut-Ãªtre un
jour je m'y collerais.

Une autre solution plus accessible, serait que j'acquiÃ¨re un lecteur Iomega Zip
en SCSI. Le [Smaky Infini][4] (en thÃ©orie) permet de travailler avec des
lecteurs Iomega Zip. Ce serait un moyen de transmettre une grande quantitÃ© de
donnÃ©es depuis mon PC Linux au Smaky. NÃ©anmoins je n'aime pas beaucoup cette
solution car il faut le [Smaky Infini][4] (et donc [Wine][6]), il faut un
lecteur obsolÃ¨te et au moins une disquette obsolÃ¨te.

Il me reste une autre option qui devrait Ãªtre moins coÃ»teuse en temps de
dÃ©veloppement et surtout beaucoup plus pÃ©renne. Je devrais arriver Ã  faire des
adaptations dans le projet [Fosfat][3] afin de pouvoir convertir une image `.DI`
en image disque SCSI. Les deux formats sont identiques concernant le FOS, ce
n'est donc (principalement) qu'une question d'offset. [Fosfat][3] sait lire tous
les blocs. Il est peut-Ãªtre possible de revoir juste le dÃ©but de l'image `.DI`
pour rajouter ce qui manque.

> (2023.03.25) Je vais Ã©crire un nouvel article dans quelques temps Ã  propos des
> travaux que je suis actuellement en train de rÃ©aliser pour les conversions.
> J'ai choisi la solution 3 prÃ©sentÃ©e ci-dessus. Pour les plus impatients, vous
> pouvez compiler la version de dÃ©veloppement de [Fosfat][3] et utiliser la
> commande `fosdd` qui rÃ©pond Ã  ce besoin.
>
> L'article est disponible ici : [BlueSCSI & Fosfat][5].

[1]: https://bluescsi.com/
[2]: https://shop.onegeekarmy.eu/
[3]: https://github.com/Skywalker13/Fosfat
[4]: https://www.smaky.ch/infini
[5]: /posts/2023.03.26_bluescsi-fosfat/
[6]: https://www.winehq.org/
