---
title: "Smaky & BlueSCSI ~ üá´üá∑"
date: 2023-03-19
tags: [smaky, bluescsi]
description: "Smaky & BlueSCSI"
draft: false
---

Il y a quelques temps j'ai √©t√© mis en contact avec un ancien Guru du Smaky,
Jean-Marc Koller. Je ne le connais que tr√®s peu mais j'ai tout de suite √©t√©
int√©ress√© par son projet du moment. Il cherche √† remplacer les disques SCSI des
Smaky par des cartes SD. J'ai imm√©diatement fait mes petites recherches sur le
sujet, Jean-Marc fait r√©f√©rence √† la carte [BlueSCSI][1].

Il explique qu'il y a des probl√®mes de communications avec cet adaptateur,
peut-√™tre des probl√®mes de timing ou d'int√©grit√©. Quoi qu'il en soit, il y a de
s√©rieux probl√®mes de stabilit√©, et Jean-Marc √©tant un √©lectronicien avanc√©
effectue toutes les mesures n√©cessaires pour identifier les causes. Cela semble
plut√¥t mal parti, mais le projet [BlueSCSI][1] retient mon attention pour deux
raisons.

1. Le projet est open-source / open-hardware et libre. Ceci est un crit√®re
   essentiel. Une communaut√© assez importante semble graviter autour, avec un
   canal Discord pour atteindre tr√®s rapidement les d√©veloppeurs et designers de
   la carte [BlueSCSI][1].
2. Ils ont cr√©√©s deux versions de la [BlueSCSI][1]. A ce moment l√† je n'ai
   absolument aucune id√©e de la version utilis√©e par Jean-Marc. Mais vu le prix
   de la carte [BlueSCSI][1] v2, je l'ach√®te dans la foul√©e.

## L'achat (un peu) √† l'aveugle

Je regarde un peu les sites propos√©s pour l'achat, et je m'arr√™te sur [One Geek
Army Shop][2] qui est (au moment de l'achat) le seul revendeur qui propose la
carte [BlueSCSI][1] v2 en variante Desktop pour le march√© europ√©en.

> Il existe plusieurs variantes, comme Desktop (50-pin SCSI), DB25 ou PowerBook.

Bien entendu, le Smaky avec son disque SCSI Fujitsu, correspond √† du 50-pin. La
carte soud√©e et √† jour ne me co√ªte qu'un peu plus de 60‚Ç¨. Je trouve le risque
pas tr√®s grand alors je commande sans trop r√©fl√©chir.

![BlueSCSI](/img/diskscsi.jpg)

### R√©ception de la carte

Environ 3 ou 4 jours plus tard, je re√ßois la carte bien emball√©e et pr√™te √†
l'emploi. Il ne me reste plus qu'√† ouvrir mon Smaky, d√©brancher le disque SCSI
actuel, trouver un adaptateur Molex ‚Üí mini Molex ainsi qu'une simple carte SD
compatible.

Depuis de nombreuses ann√©es je conserve toutes sortes de c√¢bles et mat√©riel dans
ma cave. Il se trouve que j'ai exactement tout ce qui est n√©cessaire. Un vieil
adaptateur Molex que j'avais certainement r√©cup√©r√© sur de vieux serveurs de la
Ciba SC dans les ann√©es 2000 ainsi qu'un adaptateur SD ‚Üí micro SD avec une carte
micro SD de 4 GB.

![BlueSCSI](/img/bluescsi.jpg)

## Monter un disque SCSI

Cette carte [BlueSCSI][1] est juste fantastique. Pour monter un disque SCSI il
suffit de formater la carte SD en FAT32 ou ExFat et d'y d√©poser des images
disque. Par exemple, pour monter un disque SCSI ID 1, rien de plus simple que de
nommer l'image `HD10_512.hda`.

Voici √† quoi ressemble ma carte SD actuelle :

```
-rw-r--r-- 1 schroeterm schroeterm   26 19 mar 14:24  bluescsi.ini
-rw-r--r-- 1 schroeterm schroeterm 520M 15 mar  2007 'HD10_512 MS System.hda'
-rw-r--r-- 1 schroeterm schroeterm 508M 26 sep  2019 'HD20_512 DR Model.hda'
-rw-r--r-- 1 schroeterm schroeterm 520M 19 mar 15:20 'HD30_512 DR Dev.hda'
-rw-r--r-- 1 schroeterm schroeterm 4.1K  1 jan 01:00  log.txt
```

L'image `HD10_512 MS System.hda` est un dump de mon disque SCSI original que
j'ai r√©alis√© en 2007. Pour effectuer ce dump j'ai install√© le disque du Smaky
dans un PC avec un contr√¥leur Adaptec (qui dort dans un carton); et avec l'aide
de la commande `dd`, je me suis fait une image binaire comme backup. J'ai
beaucoup utilis√© cette image pour effectuer des tests avec [Fosfat][3] pendant
que je d√©veloppais cette biblioth√®que d'acc√®s au FOS (je vous laisse consulter
le lien si cela vous int√©resse; sous Debian / Ubuntu, simplement faire
`apt install fosfat`).

> [Fosfat][3] est l'outil parfait pour lire vos disques et disquettes Smaky avec
> Linux (et aussi en partie avec Windows). Par contre, je n'ai pas d√©velopp√© le
> support de l'√©criture. Mon travail de reverse engineering s'est stopp√© d√®s que
> j'ai pu extraire ce que je souhaitais.

### bluescsi.ini

Il est possible de donner une configuration √† la carte [BlueSCSI][1] avec l'aide
d'un fichier INI. Avec un Smaky, ce fichier n'est pas n√©cessaire mais dans mon
cas je l'ai quand m√™me install√© avec cette directive :

```ini
[SCSI]
EnableSCSI2=1 ; On
```

Honn√™tement je ne sais pas si cela apporte r√©ellement une am√©lioration; mais
j'aime l'id√©e que les transferts soient plus rapide en sp√©cifiant explicitement
le mode SCSI-2 bien que je n'ai aucune certitude de ce qui se passe r√©ellement
avec ce contr√¥leur.

## D√©marrage du Smaky

Tout √† fonctionn√© du **premier coup**. Mon Smaky a d√©marr√© comme un charme sur
le disque `HD10`. J'ai pu monter le disque `HD20` en `#MM2:` puis j'ai tent√©
aussi `HD30` en `#MM3:`. J'ai quelques probl√®mes avec le disques `HD30` mais
rien qui ne concerne la [BlueSCSI][1]. L'exp√©rience est une r√©ussite compl√®te
qui va au del√† de mes esp√©rances. Le fait de pouvoir monter plusieurs disques
avec un seul adaptateur est tout simplement g√©nial.

![BlueSCSI](/img/smaky.jpg)

## Interop√©rabilit√©

A l'origine, les √©changes entre les Smaky et les PC sont assez difficiles. Pour
y rem√©di√© en partie, j'ai cr√©√© [Fosfat][3] il y a pas mal d'ann√©es. D√®s le
moment que l'on souhaite lire des donn√©es d'un Smaky sur un PC, [Fosfat][3]
rempli parfaitement son r√¥le. Il existe une autre technique, l'utilisation de
l'√©mulateur Windows [Smaky Infini][4]. Cet √©mulateur me pose quelques probl√®mes
de stabilit√© et certains outils sont difficilement exploitables (comme les
outils de conversions de fichiers `.AUDIO` en `.WAV` qui fonctionnent bien que
sur un vrai Smaky ou alors l'impossibilit√© de lire certains dossiers du PC sans
que cela provoque un blocage complet de l'√©mulateur, ...).

L'√©mulateur ne se comporte pas non plus comme s'il avait √† faire √† de vrai
disque SCSI. En effet, j'ai remarqu√© que le disque `SYSTEME` et le disque
`MODELE` ne sont pas des images disque SCSI, mais des images de type "floppy".
J'ai appris √† les diff√©rencier en travaillant sur [Fosfat][3] o√π il y a
clairement une diff√©rence d'offset entre les deux types de m√©dias.

Cette diff√©rence a un impacte directe avec l'utilisation de la [BlueSCSI][1].

1. Il n'est pas possible d'utiliser une image disque (de type `.DI`) en tant
   qu'image SCSI. Le Smaky refuse de la monter.
2. Le [Smaky Infini][4] refuse de monter une image disque SCSI comme si cette
   image √©tait un `.DI`.

J'ai tent√© d'y rem√©dier avec `CLE`. Par exemple en montant une image √† la place
du disque `MODELE` dans le [Smaky Infini][4]. Je peux formater cette image
depuis `CLE` avec :

```
format #MM2:
```

Je peux alors √©crire dans cette image. Par contre, bien que le [Smaky Infini][4]
me l'affiche comme une m√©moire de masse, ce n'en est pas vraiment une. En
r√©alit√© c'est un type `$FILE_2` qui est un `DI` et donc impossible √† monter en
tant que disque SCSI sur la [BlueSCSI][1].

### Quelques solutions √† explorer

La meilleure solution serait que j'impl√©mente l'√©criture avec [Fosfat][3]. C'est
un gros travail de recherche et j'ai d'autres projets sur le feu. Peut-√™tre un
jour je m'y collerais.

Une autre solution plus accessible, serait que j'acqui√®re un lecteur Iomega Zip
en SCSI. Le [Smaky Infini][4] (en th√©orie) permet de travailler avec des
lecteurs Iomega Zip. Ce serait un moyen de transmettre une grande quantit√© de
donn√©es depuis mon PC Linux au Smaky. N√©anmoins je n'aime pas beaucoup cette
solution car il faut le [Smaky Infini][4] (et donc wine), il faut un lecteur
obsol√®te et au moins une disquette obsol√®te.

Il me reste une autre option qui devrait √™tre moins co√ªteuse en temps de
d√©veloppement et surtout beaucoup plus p√©renne. Je devrais arriver √† faire des
adaptations dans le projet [Fosfat][3] afin de pouvoir convertir une image `.DI`
en image disque SCSI. Les deux formats sont identiques concernant le FOS, ce
n'est donc (principalement) qu'une question d'offset. [Fosfat][3] sait lire tous
les blocs. Il est peut-√™tre possible de revoir juste le d√©but de l'image `.DI`
pour rajouter ce qui manque.

> [2023.03.25] Je vais √©crire un nouvel article dans quelques temps √† propos des
> travaux que je suis actuellement en train de r√©aliser pour les conversions.
> J'ai choisi la solution 3 pr√©sent√©e ci-dessus. Pour les plus impatients, vous
> pouvez compiler la version de d√©veloppement de [Fosfat][3] et utiliser la
> commande `fosdd` qui r√©pond √† ce besoin.

[1]: https://bluescsi.com/
[2]: https://shop.onegeekarmy.eu/
[3]: https://github.com/Skywalker13/Fosfat
[4]: https://www.smaky.ch/infini
