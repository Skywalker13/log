+++
date = "2016-08-04T13:17:00+01:00"
draft = false
title = "Relocatable binaries paths with rpath"
tags = ["javascript", "npm", "node"]
+++

# rpath

## Portable binaries on Linux and Darwin

The rpath functionality is something that exists only on unix and unix-like OS. It's very powerful in order to manage the dynamic loading as you want. The goal here is not to explain rpath, just use your favorite search engine for that. Here I will told you how to use rpath in order to provide binaries and libraries without [a dependency on the system paths][2] like `/usr/lib` and without the use of `LD_LIBRARY_PATH` or `DYLD_LIBRARY_PATH` which can be very dangerous and even a bit limited on Darwin (see [SIP][1].

## On Linux

It's simple but it's a bit more limited that on Darwin. In most of cases you have your libraries in the `./lib` and the main executable in `./bin`. It means that the main executable must look for your libraries in `../lib`.

In order to add a relative path, you must link with `-rpath`. This attribute must provides one or more paths where the dynamic libraries must be searched.

You can pass this attribute with the `CFLAGS` for the linker. For example:
```sh
make CFLAGS=-Wl,-rpath=\$$ORIGIN/../lib
```

The original string is `-Wl,-rpath=$ORIGIN/../lib` but [$] is expanded by the shell and by the Makefile. `\$` is for preventing the expansion by the shell and `$$` by make.

Note that you can more than one path just by doing like this: `-Wl,-rpath=$ORIGIN/../lib:/opt/my/lib`.

## On Darwin

---

[1]:
[2]: https://en.wikipedia.org/w/index.php?title=Rpath&oldid=728408353#GNU_ld.so
